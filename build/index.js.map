{"version":3,"sources":["../src/index.js"],"names":["Wrapper","styled","div","props","scaleSize","HiddenInput","input","Placeholder","image","placeholder","Imageination","state","React","createRef","fileInput","imageToBase64","target","reader","FileReader","onload","e","getArrayBufferOrientation","result","readAsArrayBuffer","arrayBuffer","arrayBufferExif","EXIF","readFromBinaryFile","orientation","Orientation","orientImage","thisImage","Image","ratio","width","height","can1","canvasW","canvasH","drawImgX","drawImgY","rotate","translateX","translateY","imageToCanvas","can3","Math","PI","can6","can8","canDefault","src","URL","createObjectURL","canVals","can","document","createElement","ctx","getContext","translate","save","drawImage","restore","setState","toDataURL","sendImageToParent","handleUpload","current","files","triggerFileInput","click","onImage","Component"],"mappings":"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","file":"index.js","sourcesContent":["/* @flow */\n/**********************************\n* React component to resize and\n* correct image orientation\n* automatically in the frontend.\n*\n* Â© 2018 Charlie Hay\n**********************************/\n\n/**********************************\n* NODE MODULES\n**********************************/\nimport React from 'react';\nimport styled from 'styled-components';\nimport EXIF from 'exif-js';\n\n/**********************************\n* LOCAL FILES\n**********************************/\nimport placeholder from './assets/placeholder.jpg';\n\nconst Wrapper = styled.div`\n\theight: ${props => props.scaleSize}px;\n\twidth: ${props => props.scaleSize}px;\n`;\n\nconst HiddenInput = styled.input`\n\tdisplay: none;\n`;\n\nconst Placeholder = styled.div`\n\tborder: 1px solid #000;\n\tbackground: url(${props => props.image ? props.image : placeholder});\n\tdisplay: inline-block;\n\tbackground-repeat: no-repeat;\n\tbackground-position: center;\n\tbackground-size: cover;\n\theight: 100%;\n\twidth: 100%;\n`\n\n/**********************************\n\tComponent\n**********************************/\nexport default class Imageination extends React.Component {\n\n\tstate = {\n\t\tplaceholder: React.createRef(),\n\t\tfileInput: React.createRef(),\n\t\timage: null\n\t}\n\n\t/**\n\t* Convert the target image to Base64.\n\t*/\n\timageToBase64 = (target) => {\n\n\t\t// Create a new FileReader.\n\t\tconst reader = new FileReader();\n\n\t\t// When read send result to base64toBlob.\n\t\treader.onload = (e) => {\n\t\t\tthis.getArrayBufferOrientation(e.target.result, target);\n\t\t}\n\n\t\t// Read the target as DataURL.\n\t\treader.readAsArrayBuffer(target);\n\t}\n\n\t/**\n\t*\tGet orientation data from EXIF.\n\t*/\n\tgetArrayBufferOrientation = (arrayBuffer, target) => {\n\n\t\t// Read EXIF Orientation data.\n\t\tconst arrayBufferExif = EXIF.readFromBinaryFile(arrayBuffer);\n\n\t\t// Assign orientation value.\n\t\tlet orientation = arrayBufferExif.Orientation;\n\n\t\t// Send result to orientImage.\n\t\tthis.orientImage(arrayBuffer, orientation, target);\n\t}\n\n\t/**\n\t* Orient the image based on EXIF data.\n\t*/\n\torientImage = (image, orientation, target) => {\n\n\t\t// Create a new Image called thisImage.\n\t\tconst thisImage = new Image();\n\n\t\t// Onload, route to proper orientation.\n\t\tthisImage.onload = () => {\n\n\t\t\t// Create a consitient ratio to original image.\n\t\t\tconst ratio = thisImage.width / thisImage.height;\n\n\t\t\tconst scaleSize = this.props.scaleSize;\n\n\t\t\t// Switch statement based on orientation value.\n\t\t\tswitch (orientation) {\n\t\t\t\tcase 1:\n\t\t\t\t\t// Counter Clockwise -> Landscape (Top Facing Right).\n\t\t\t\t\tconst can1 = {\n\t\t\t\t\t\tcanvasW: scaleSize * ratio,\n\t\t\t\t\t\tcanvasH: scaleSize,\n\t\t\t\t\t\tdrawImgX: scaleSize * ratio,\n\t\t\t\t\t\tdrawImgY: scaleSize,\n\t\t\t\t\t\trotate: 0,\n\t\t\t\t\t\ttranslateX: 0,\n\t\t\t\t\t\ttranslateY: 0\n\t\t\t\t\t}\n\t\t\t\t\tthis.imageToCanvas(can1, thisImage);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\t// Clockwise -> Landscape (Top Facing Left).\n\t\t\t\t\tconst can3 = {\n\t\t\t\t\t\tcanvasW: scaleSize * ratio,\n\t\t\t\t\t\tcanvasH: scaleSize,\n\t\t\t\t\t\tdrawImgX: scaleSize * ratio,\n\t\t\t\t\t\tdrawImgY: scaleSize,\n\t\t\t\t\t\trotate: 180 * Math.PI / 180,\n\t\t\t\t\t\ttranslateX: -scaleSize * ratio,\n\t\t\t\t\t\ttranslateY: -scaleSize\n\t\t\t\t\t}\n\t\t\t\t\tthis.imageToCanvas(can3, thisImage);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\t// Vertical -> Portrait (Upside up).\n\t\t\t\t\tconst can6 = {\n\t\t\t\t\t\tcanvasW: scaleSize,\n\t\t\t\t\t\tcanvasH: scaleSize * ratio,\n\t\t\t\t\t\tdrawImgX: scaleSize * ratio,\n\t\t\t\t\t\tdrawImgY: scaleSize,\n\t\t\t\t\t\trotate: 90 * Math.PI / 180,\n\t\t\t\t\t\ttranslateX: 0,\n\t\t\t\t\t\ttranslateY: -scaleSize\n\t\t\t\t\t}\n\t\t\t\t\tthis.imageToCanvas(can6, thisImage);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 8:\n\t\t\t\t\t// Vertical -> Portrait (Upside down).\n\t\t\t\t\tconst can8 = {\n\t\t\t\t\t\tcanvasW: scaleSize,\n\t\t\t\t\t\tcanvasH: scaleSize * ratio,\n\t\t\t\t\t\tdrawImgX: scaleSize * ratio,\n\t\t\t\t\t\tdrawImgY: scaleSize,\n\t\t\t\t\t\trotate: -90 * Math.PI / 180,\n\t\t\t\t\t\ttranslateX: -scaleSize * ratio,\n\t\t\t\t\t\ttranslateY: 0\n\t\t\t\t\t}\n\t\t\t\t\tthis.imageToCanvas(can8, thisImage);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// No Available Data.\n\t\t\t\t\tconst canDefault = {\n\t\t\t\t\t\tcanvasW: scaleSize * ratio,\n\t\t\t\t\t\tcanvasH: scaleSize,\n\t\t\t\t\t\tdrawImgX: scaleSize * ratio,\n\t\t\t\t\t\tdrawImgY: scaleSize,\n\t\t\t\t\t\trotate: 0,\n\t\t\t\t\t\ttranslateX: 0,\n\t\t\t\t\t\ttranslateY: 0\n\t\t\t\t\t}\n\t\t\t\t\tthis.imageToCanvas(canDefault, thisImage)\n\t\t\t}\n\t\t}\n\n\t\t// Read thisImage into a new Object URL.\n\t\tthisImage.src = URL.createObjectURL(target);\n\n\t}\n\n\t/**\n\t* Draw the image to Canvas.\n\t*/\n\timageToCanvas = (canVals, thisImage) => {\n\n\t\t// Create new Canvas.\n\t\tconst can = document.createElement(\"canvas\");\n\n\t\t// Create '2D' context.\n\t\tconst ctx = can.getContext('2d');\n\n\t\t// Perform Canvas Operations.\n\t\tcan.width = canVals.canvasW;\n\t\tcan.height = canVals.canvasH;\n\t\tctx.rotate(canVals.rotate); ctx.translate(canVals.translateX, canVals.translateY);\n\t\tctx.save();\n\t\tctx.drawImage(thisImage, 0, 0, canVals.drawImgX, canVals.drawImgY);\n\t\tctx.restore();\n\n\t\t// Send the canvas data Url to showImage.\n\t\tthis.setState({image: can.toDataURL()}, this.sendImageToParent());\n\n\t}\n\n\tsendImageToParent() {\n\t\tthis.props.onImage(this.state.image);\n\t}\n\n\t/**\n\t*\tHandle Upload of Image.\n\t*/\n\thandleUpload = () => {\n\t\tthis.imageToBase64(this.state.fileInput.current.files[0]);\n\t}\n\n\t/**\n\t* Trigger click on fileInput.\n\t*/\n\ttriggerFileInput = () => {\n\t\tthis.state.fileInput.current.click();\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<Wrapper scaleSize={this.props.scaleSize}>\n\t\t\t\t<Placeholder onClick={this.triggerFileInput} ref={this.state.placeholder} image={this.state.image}>\n\t\t\t\t\t<HiddenInput onChange={this.handleUpload} innerRef={this.state.fileInput} alt=\"hidden file input\" type=\"file\" accept=\"image/*\" />\n\t\t\t\t</Placeholder>\n\t\t\t</Wrapper>\n\t\t)\n\t}\n}\n"]}